FROM ubuntu:20.04

USER root

# Install required packages
RUN apt-get update && \
    apt-get install -y \
    sudo \
    nano \
    apt-transport-https \
    ca-certificates \
    wget \
    curl \
    gnupg-agent \
    software-properties-common \
    && rm -rf /var/lib/apt/lists/*

# Import Microsoft GPG keys
RUN wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb && \
    dpkg -i packages-microsoft-prod.deb && \
    rm packages-microsoft-prod.deb

# Install PowerShell
RUN apt-get update && \
    apt-get install -y powershell

# Install ttyd
RUN curl -LO https://github.com/tsl0922/ttyd/releases/download/1.7.3/ttyd.x86_64 && \
    mv ttyd.x86_64 /usr/local/bin/ttyd && \
    chmod +x /usr/local/bin/ttyd

# Create a new user and set password
RUN useradd -ms /bin/bash mcdns && \
    echo "mcdns:mcdns123" | chpasswd

# Add the new user to the "sudo" group so that they can run commands with superuser privileges
RUN usermod -aG sudo mcdns

# Set the default login user to the new user
USER mcdns

# Set the working directory to the new user's home directory
WORKDIR /

# Expose port 8080
EXPOSE 8080

# Run ttyd with the command line options you need
CMD ["ttyd", "-p", "8080", "pwsh"]
